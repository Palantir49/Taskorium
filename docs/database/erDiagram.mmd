erDiagram
    Users {
        Guid id PK
        Guid keycloak_id
        varchar(50) login
        varchar(100) email
        varchar(50) username "Отображаемое имя"
        timestamp created_at
    }

    Workspaces {
        Guid id PK
        varchar(100) name
        bigint owner_id FK "→ Users.id"
        timestamp created_at
    }

    WorkspaceMembers {
        Guid workspace_id PK,FK "→ Workspaces.id"
        Guid user_id PK,FK "→ Users.id"
        varchar(10) role "member | admin"
        timestamp joined_at
    }

    Projects {
        Guid id PK
        Guid workspace_id FK "→ Workspaces.id"
        varchar(100) name
        text description
        timestamp created_at
    }

    ProjectMembers {
        Guid project_id PK,FK "→ Projects.id"
        Guid user_id PK,FK "→ Users.id"
        varchar(10) role "viewer | member | admin"
        timestamp joined_at
    }

    IssueTypes {
        int id PK
        varchar(50) name
        char(7) color
        boolean is_default
    }


    Statuses {
        int id PK
        varchar(50) name
        varchar(20) category "todo | in_progress | done"
        int position
        char(7) color
    }

    Issues {
        Guid id PK
        bigint project_id FK "→ Projects.id"
        varchar(20) key "PROJ-123"
        varchar(255) summary
        text description
        int issue_type_id FK "→ IssueTypes.id"
        int status_id FK "→ Statuses.id"
        Guid reporter_id FK "→ Users.id"
        int priority "1-5, где 1 - наивысший"
        timestamp created_at
        timestamp updated_at
        timestamp resolved_at "NULL"
        timestamp due_date "NULL"
    }

    IssueAssignees {
        Guid issue_id PK,FK "→ Issues.id"
        Guid user_id PK,FK "→ Users.id"
        timestamp assigned_at
        boolean is_lead "основной исполнитель"
    }

    Comments {
        Guid id PK
        Guid issue_id FK "→ Issues.id"
        Guid author_id FK "→ Users.id"
        text content
        timestamp created_at
        timestamp updated_at "NULL"
    }

    Attachments {
        Guid id PK
        Guid issue_id FK "→ Issues.id"
        Guid uploader_id FK "→ Users.id"
        varchar(512) storage_path
    }

    StatusTransitions {
        Guid id PK
        Guid workspace_id FK
        Guid from_status_id FK "→ Statuses.id"
        Guid to_status_id FK "→ Statuses.id"
        varchar(10) allowed_role "NULL = любой"
    }


    Workspaces ||--o{ Projects : "содержит"
    Workspaces ||--o{ WorkspaceMembers : "имеет участников"
    Workspaces }o--|| Users : "владелец"

    Projects ||--o{ Issues : "содержит задачи"
    Projects ||--o{ ProjectMembers : "имеет участников"
    Projects ||--o{ IssueTypes : "определяет типы задач"
    Projects ||--o{ Statuses : "определяет статусы"
    Projects ||--o{ StatusTransitions : "определяет переходы"


    Issues ||--o{ IssueAssignees : "имеет исполнителей"
    Issues ||--o{ Comments : "содержит комментарии"
    Issues ||--o{ Attachments : "содержит файлы"
    Issues }o--|| Users : "автор (reporter)"
    Issues }o--|| IssueTypes : "тип задачи"
    Issues }o--|| Statuses : "текущий статус"

    Users ||--o{ IssueAssignees : "исполнитель(и) задач"
    Users ||--o{ WorkspaceMembers : "участник пространства"
    Users ||--o{ ProjectMembers : "участник проекта"
    Users ||--o{ Comments : "автор комментария"
    Users ||--o{ Attachments : "загрузил файл"

 